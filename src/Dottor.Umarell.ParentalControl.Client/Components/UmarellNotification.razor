@implements IAsyncDisposable
@inject IGeofenceService GeofenceService
@inject IToastService ToastService
@inject IMessageService MessageService
@inject IDialogService DialogService

<FluentToastProvider />
<FluentDialogProvider />
<FluentTooltipProvider />

@code {

    protected override async Task OnInitializedAsync()
    {
        GeofenceService.OutOfZone += OutOfZoneCallback;
        await GeofenceService.StartMonitoringAsync();
    }

    private Task OutOfZoneCallback(GeofenceEventArg e)
    {
        MessageService.ShowMessageBar(options =>
            {
                options.Intent = MessageIntent.Warning;
                options.Title = $"Umarell warning";
                options.Body = "L'umarell è uscito dall'area specificata.";
                options.AllowDismiss = true;
                options.Timestamp = DateTime.Now;
                options.Section = "MESSAGES_NOTIFICATION_CENTER";
            });

        // ToastService.ShowWarning("L'umarell è uscito dall'area specificata.");
        // DialogService.ShowWarning("L'umarell è uscito dall'area specificata.");

        return Task.CompletedTask;
    }

    public async ValueTask DisposeAsync()
    {
        if (GeofenceService is not null)
        {
            GeofenceService.OutOfZone -= OutOfZoneCallback;
            await GeofenceService.DisposeAsync();
        }
    }
}
